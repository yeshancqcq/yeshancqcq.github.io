<!DOCTYPE html>
<html>
<head>

	<title>Quick Start - Leaflet</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.0/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
		<link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/leaflet@1.3.0/dist/leaflet.js" integrity="sha512-C7BBF9irt5R7hqbUm2uxtODlUVs+IsNu2UULGuZN7gM+k/mmeG4xvIEac01BtQa4YIkUpp23zZC4wIwuXaPMQA==" crossorigin=""></script>
		<script src="js/leaflet.ajax.min.js"></script>

		<style>
		#mapid {
			width: 100%;
		}
		.leaflet-popup-content-wrapper {
			border-radius: 0;
	    background: black;
	    color: white;
	    font-size: 20px;
		}
		.leaflet-popup-content {
			margin: 5px;
		}
		.leaflet-popup-tip {
			background: black;
		}
		.leaflet-popup-close-button {
			display: none;
		}

		/*another-popop style*/
.another-popup .leaflet-popup-content-wrapper {
  background: #e6f2ff;
  color: #0066cc;
  font-size: 16px;
  line-height: 24px;
  border-radius: 0;
}
.another-popup.leaflet-popup-content {
	margin: 5px;
}
.another-popup .leaflet-popup-tip-container {
  width: 50px;
  height: 15px;
}
.another-popup .leaflet-popup-tip {
  background: #e6f2ff;
  border: none;
  box-shadow: none;
}
		</style>


</head>
<body>

<div id ="heading1"><center><p1>Metadata And Spatial Grids test</p1></center></div>
<div id ="heading2"><center><p2>Data From Shakun and Marcott papers</p2></center></div>
<div id ="heading2"><center><p2>With data points and spatial grids (select from the dropdown menu at the upper right cornor of the map).</p2></center></div>
<div id ="intro"><center><p2>Use a laptop or PC to view this site. Cell phone is not currently supported.</p2></center></div>
	<div id ="intro"><center><p2>Temporary working map by <a href="http://yeshancqcq.github.io">Shan Ye</a></p2></center></div>

		<div id ="intro"><center>		<br>
		<p>Enter the Years BP (whole hundred) to be mapped:
			 <input type="number" id="myText" value="1400">

		<button onclick="inputAge(); temporalGrid_style();">Map it</button></p>

		Mapping the anomaly distribution at the age (years bp) shown below:
		<p id="test1"></p>
		<p id="test2"></p>
		<p id="test3"></p>
		<p id="test4"></p>
		<p id="test5"></p>

<select id="mySelect" size="4">
  <option value="100">100 Years BP</option>
  <option value="200">200 Years BP</option>
  <option value="300">300 Years BP</option>
  <option value="400">400 Years BP</option>
</select>
<button onclick="temporalGrid_style()">Try it</button>
</center></div>
	<div id="wrapper">
	<div id="map">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
<script id="mapHere">

		// Initiating base map layers
		var topographic = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}', {
			maxZoom: 30,
      minZoom: 2,
			attribution: 'Tiles &copy; Esri &mdash; Source: Esri'
		}),
		satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
			maxZoom: 30,
      minZoom: 2,
			attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
		});

		//Initiating map layer groups

		var sites = L.layerGroup();
		var grid = L.layerGroup();
    var temporal = L.layerGroup();

  // Initiating icon as var
  var blackIcon = L.icon({
  iconUrl: 'img/map-marker.svg',
  iconSize: [11,44],
  iconAnchor: [11,44],
  popupAnchor: [0,-10]
  });

  var redIcon = L.icon({
  iconUrl: 'img/map-marker-red.svg',
	iconSize: [23,74],
  iconAnchor: [23,74],
  popupAnchor: [0,-10]
  });

		//Starting style of grid layer 1
		function grid_style(feature) {
    return {
        fillColor: '#BDBDBD',
        weight: 1,
        opacity: 1,
        color: '#FFF',
        dashArray: '',
        fillOpacity: 0.3
    };
}

		//Initiating 2 different popups
		var popup1 = L.popup({
			maxWidth : 1800
		});
		var popup2 =
    {
      'maxWidth': '500',
      'className' : 'another-popup' // classname for another popup
    }

	//Add the grid layer1
	var grid_layer= new L.GeoJSON.AJAX("data/ref_grid.geojson", {
			style: grid_style,
			onEachFeature: function (feature, layer) {
        layer.on('mouseover', function () {
            this.setStyle({
							weight: 1,
			        color: '#666',
			        dashArray: '',
			        fillOpacity: 0.8
            });
        });
        layer.on('mouseout', function () {
            grid_layer.resetStyle(this);
        },
				layer.bindPopup('<p>'+feature.properties.PageName+'</p>')
				);
    }
	}).addTo(grid);



    //Add data point as a layer
		var sites = new L.GeoJSON.AJAX("data/anomaly.geojson",{
			style : function(feature) {
				return {
					color: '#000',
					weight: 0.5
				}
			},
			pointToLayer: function(geoJsonPoint, latlng) {
				return L.marker(latlng,{
				icon: blackIcon
			})
			},
			onEachFeature: function(feature, layer) {
				layer.on('click',function(e) {
					map.setView(e.latlng,3);
					$("#paneltext").html('<h2> '+feature.properties.Location_o+'</h2><p> Metadata source: '
										+feature.properties.Author+'</p><p> Proxy: '
										+feature.properties.Proxy+'</p><p> Temperature reference: '
										+feature.properties.Temperatur+'</p>');
				}),
				layer.bindPopup('<h2>'+feature.properties.Location_o+'</h2>', popup2)
			}
		}).addTo(sites);

		//Combining received text with t
   function getAnomaly(x){
    var header = 't' + x.toString()
    return header
   }

	 //Color ramp for grid layer 2
  function getColor(i){
    var colorToUse
    var field = i
    if (field >= 10) colorToUse = "#800026";
    else if (field >= 8) colorToUse = "#bd0026";
    else if (field >= 6) colorToUse = "#e31a1c";
    else if (field >= 4) colorToUse = "#fc4e2a";
    else if (field >= 2) colorToUse = "#fd8d3c";
    else if (field > 0) colorToUse = "#feb24c";
    else if (field == 0) colorToUse = "#ffffcc";
    else if (field >= -2) colorToUse = "#e0f3f8";
    else if (field >= -4) colorToUse = "#9ecae1";
    else if (field >= -6) colorToUse = "#6baed6";
    else if (field >= -8) colorToUse = "#4292c6";
    else if (field >= -10) colorToUse = "#2171b5";
    else colorToUse = "#08519c";
		
    return colorToUse
  }

	// Receiving the text from HTML,this is from Select menu
	function inputAge() {
		var x = $('#mySelect').val();
		return x
	}

	// Style of gird layer 2
	function temporalGrid_style(feature){
		// Getting the text from the HTML (either from Select menu or from input box)
		//var sel = $('#mySelect').val();

  //Intiating var style, get the value from inputAge, and convert to number
		var style = parseInt(inputAge(),10)
		var age = getAnomaly(style.toString())
		//test var, print in HTML
		document.getElementById("test1").innerHTML = style
		document.getElementById("test2").innerHTML = age
		document.getElementById("test3").innerHTML = feature.properties[age]
		document.getElementById("test4").innerHTML = typeof feature.properties[age]
		document.getElementById("test5").innerHTML = typeof age
		return {
         //style of
         weight: 0.1,
         opacity: 0.5,
         color: getColor(feature.properties[age]),
				 fillOpacity: 0.4
       };
}
	//Add grid layer 2
  var temporalGrid = new L.GeoJSON.AJAX("data/ref_grid_time.geojson",{
    style : temporalGrid_style
	}).addTo(temporal);

	//Add map
	var map = L.map('map', {
			center: [0,0],
		  zoom: 1,
			layers: [topographic, sites, temporal]
	});


		//Setting base layer and overlay layers

	var baseLayers = {
		"Topographic":topographic,
		"Satellite": satellite
	};

	var overlays = {
		"Sites": sites,
		"Grids": grid,
  	"Temporal Grids": temporal
	};

//Add layer control
L.control.layers(baseLayers, overlays).addTo(map);




</script>
</div></div>
 <div id="paneltext" align="left"></div>


</body>
</html>
