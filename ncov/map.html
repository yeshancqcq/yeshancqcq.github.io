<!DOCTYPE html>
<html>
<head>

	<title>2019-nCoV Map</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" type="../image/x-icon" href="../docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.0/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
		<link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/leaflet@1.3.0/dist/leaflet.js" integrity="sha512-C7BBF9irt5R7hqbUm2uxtODlUVs+IsNu2UULGuZN7gM+k/mmeG4xvIEac01BtQa4YIkUpp23zZC4wIwuXaPMQA==" crossorigin=""></script>
		<script src="../anomaly/js/leaflet.ajax.min.js"></script>

		<style>
		#mapid {
			width: 100%;
		}
		.leaflet-popup-content-wrapper {
	    background: #2ca25f;
			color: white;
			font-family:  Georgia;
		  font-size: 16px;
		  line-height: 24px;
		  border-radius: 0;
			opacity: 0.7;
		}
		.leaflet-popup-content {
			margin: 5px;
		}
		.leaflet-popup-tip {
			background: #2ca25f;
			opacity: 0.7;
			border: none;
			box-shadow: none;
		}
		.leaflet-popup-tip-container {
		  width: 50px;
		  height: 15px;
		}

		/*another-popop style*/
.another-popup .leaflet-popup-content-wrapper {
  background: #9c1309;
  color: white;
	font-family:  Georgia;
	opacity: 0.7;
  font-size: 16px;
  line-height: 24px;
  border-radius: 0;
}
.another-popup.leaflet-popup-content {
	margin: 5px;
}
.another-popup .leaflet-popup-tip-container {
  width: 50px;
  height: 15px;
}
.another-popup .leaflet-popup-tip {
  background: #9c1309;
	opacity: 0.7;
  border: none;
  box-shadow: none;
}

/*another-popop style*/
.another-popup2 .leaflet-popup-content-wrapper {
background: #756bb1;
color: white;
font-family: : Georgia;
opacity: 0.7;
font-size: 16px;
line-height: 24px;
border-radius: 0;
}
.another-popup2.leaflet-popup-content {
margin: 5px;
}
.another-popup2 .leaflet-popup-tip-container {
width: 50px;
height: 15px;
}
.another-popup2 .leaflet-popup-tip {
background: #756bb1;
opacity: 0.7;
border: none;
box-shadow: none;
}

/*another-popop style*/
.another-popup3 .leaflet-popup-content-wrapper {
background: #3182bd;
color: white;
font-family:  Georgia;
opacity: 0.7;
font-size: 16px;
line-height: 24px;
border-radius: 0;
}
.another-popup3.leaflet-popup-content {
margin: 5px;
}
.another-popup3 .leaflet-popup-tip-container {
width: 50px;
height: 15px;
}
.another-popup3 .leaflet-popup-tip {
background: #3182bd;
opacity: 0.7;
border: none;
box-shadow: none;
}

/*another-popop style*/
.another-popup4 .leaflet-popup-content-wrapper {
background: yellow;
color: red;
font-family:  Georgia;
opacity: 0.7;
font-size: 16px;
line-height: 24px;
border-radius: 0;
}
.another-popup4.leaflet-popup-content {
margin: 5px;
}
.another-popup4 .leaflet-popup-tip-container {
width: 50px;
height: 15px;
}
.another-popup4 .leaflet-popup-tip {
background: yellow;
opacity: 0.7;
border: none;
box-shadow: none;
}

/*leaflet layer control*/
.leaflet-control-layers-toggle{
    width:auto;
		background-color: #e3cea8;
		background-size: 20px 20px;
    text-decoration:none;
    line-height:36px;
		font-family:  Georgia;
}
.leaflet-control-layers-expanded {
  color: white;
	background-color: black;
	text-align: left;
	font-family:  Georgia;
	font-size: 10pt;
}

.leaflet-control-zoomControl-toggle {
	color: black;
	background-size: 20px 20px;
  }



		</style>


</head>
<body>


<div id="about">
<div id ="intro"><center><h3>新型冠状病毒疫情分布地图<br>COVID-19 Map</h3>

	<div id ="intro"><p2>疫情数据/Data From:  <br>
		<a href="https://gisanddata.maps.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6">Global</a> |
		<a href="https://3g.dxy.cn/newh5/view/pneumonia?scene=2&clicktime=1579582238&enterid=1579582238&from=singlemessage&isappinstalled=0">China</a> |
		<a href="https://www.cdc.gov/publichealthgateway/healthdirectories/healthdepartments.html">USA</a>
		<br>
		<a href="https://www.gov.uk/government/publications/covid-19-track-coronavirus-cases">UK</a> |
		<a href="https://covid19.isciii.es/">Spain</a> |
		<a href="https://www.santepubliquefrance.fr/maladies-et-traumatismes/maladies-et-infections-respiratoires/infection-a-coronavirus/articles/infection-au-nouveau-coronavirus-sars-cov-2-covid-19-france-et-monde">France</a> |
		<a href="https://github.com/pcm-dpc/COVID-19/blob/master/dati-province/dpc-covid19-ita-province-20200317.csv">Italy</a> |
		<a href="https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Fallzahlen.html">Germany</a>
	</p2><br>
		<p2>截止到/Last Updated: <br>  2020-03-22 22:00 (CST 芝加哥时间)</p2>
		<div><center>右上角可切换底图和数据类型<br>Add or change basemaps and data types at the upper-right menu.</center></div>
	<div><center><a href="https://yeshancqcq.github.io/">返回主页/Shan Ye's Homepage</a></center></div>
</center>
</center></div>
</center></div>
<center>
	<div id="wrapper">
	<div id="map">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
<script id="mapHere">

//	$(document).ready(function()
		// Initiating base map layers
		var
		topographic = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}', {
			maxZoom: 30,
      minZoom: 2,
			bounds: mybounds,
			attribution: 'Tiles &copy; Esri &mdash; Source: Esri'
		}),
		satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
			maxZoom: 30,
      minZoom: 2,
			bounds: mybounds,
			attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
		}),

		boundary = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', {
			maxZoom: 30,
			minZoom: 2,
			bounds: mybounds,
			attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
		});

		var default1 = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', {
			attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
			subdomains: 'abcd',
			maxZoom: 30,
			minZoom: 2,
			bounds: mybounds
		});

		//Initiating map layer groups

		var sites = L.layerGroup();
		var remain = L.layerGroup();
		var recover = L.layerGroup();
		var death = L.layerGroup();
		var usa_cities = L.layerGroup();
		var uk = L.layerGroup();
		var europe = L.layerGroup();
		var southWest = L.latLng(-85, -200),
				northEast = L.latLng(85, 200),
				mybounds = L.latLngBounds(southWest, northEast);


		//Initiating 2 different popups
		var popup1 = {
      'minWidth': '100',
      'className' : 'popup' // classname for another popup
    };
		var popup2 =
    {
      'minWidth': '100',
      'className' : 'another-popup' // classname for another popup
    };
		var popup3 =
		{
			'minWidth': '100',
			'className' : 'another-popup2' // classname for another popup
		};
		var popup4 =
		{
			'minWidth': '100',
			'className' : 'another-popup3' // classname for another popup
		}
		var popup5 =
		{
			'minWidth': '100',
			'className' : 'another-popup4' // classname for another popup
		}

		var datacircles = {
    radius: 5,
    fillColor: "red",
    color: "#000",
    weight: 5,
    opacity: 0.3,
    fillOpacity: 0.3};


			function getR(i){
				var r
				var field = i
				r = Math.log10(field)*5 + 3
				return r
			}


			function getColor(i){
				var color
				var field = i
				if (field == 0) color = "none";
				else if (field < 10) color="#cb181d";
				else if (field < 100) color="#ef3b2c";
				else if (field < 1000) color="#fb6a4a";
				else if (field < 2000) color="#fc9272";
				else if (isNaN(field)) color = "none";
				else color="#fcbba1";


				return color
			}

			function getColorUS(i){
				var color
				var field = i
				if (field == 0) color = "none";
				else color="yellow";
				return color
			}
			function getColorUSStrike(i){
				var color
				var field = i
				if (field == 0) color = "none";
				else color="red";
				return color
			}




    //Add data point as a layer
		var sites = new L.GeoJSON.AJAX("data/data.geojson",{
			style : function(feature) {
				return {
					color: getColor(feature.properties.case),
					fillColor: getColor(feature.properties.case),
					weight: 0.5,
					radius: getR(feature.properties.case)
				}
			},
			pointToLayer: function(geoJsonPoint, latlng) {
			return L.circleMarker(latlng,
				{
		    color: "#000",
		    weight: 5,
		    opacity: 0.5,
		    fillOpacity: 0.6}

			)
			},
			onEachFeature: function(feature, layer) {
				layer.on('click',function(e) {
					map.setView(e.latlng);
					$("#paneltext").html('<h3> '+feature.properties.city+' '
										+feature.properties.province +'</h3> 死亡率/Death Rate: '
										+feature.properties.death_rate+'%<br> 治愈率/Cure Rate: '
										+feature.properties.cure_rate+'%</p>');
				}),
				layer.bindPopup('<h3> '+feature.properties.province_cn+' '
									+feature.properties.city_cn +'</h3> 确诊/Confirmed: '
									+feature.properties.case+'<br> 剩余/Remaining: '
									+feature.properties.remain+'<br> 治愈/Recoverd: '
									+feature.properties.cure+'<br> 死亡/Death: '
									+feature.properties.death+'</p>', popup2)
			}
		}).addTo(sites);

// remains


function getColor2(i){
	var color
	var field = i
	if (field == 0) color = "none";
	else if (field < 10) color="#2ca25f";
	else if (field < 100) color="#66c2a4";
	else if (field < 1000) color="#99d8c9";
	else if (field < 2000) color="#ccece6";
	else if (isNaN(field)) color = "none";
	else color="#edf8fb";
	return color
}

function getColor3(i){
	var color
	var field = i
	if (field == 0) color = "none";
	else if (field < 10) color="#756bb1";
	else if (field < 100) color="#9e9ac8";
	else if (field < 1000) color="#bcbddc";
	else if (field < 2000) color="#dadaeb";
	else if (isNaN(field)) color = "none";
	else color="#f2f0f7";
	return color
}

function getColor4(i){
	var color
	var field = i
	if (field == 0) color = "none";
	else if (field < 10) color="#3182bd";
	else if (field < 100) color="#6baed6";
	else if (field < 1000) color="#9ecae1";
	else if (field < 2000) color="#c6dbef";
	else if (isNaN(field)) color = "none";
	else color="#eff3ff";
	return color
}


		var remain = new L.GeoJSON.AJAX("data/data.geojson",{
			style : function(feature) {
				return {
					color: getColor2(feature.properties.remain),
					fillColor: getColor2(feature.properties.remain),
					weight: 0.5,
					radius: getR(feature.properties.remain)
				}
			},
			pointToLayer: function(geoJsonPoint, latlng) {
			return L.circleMarker(latlng,
				{
		    color: "#000",
		    weight: 5,
		    opacity: 0.5,
		    fillOpacity: 0.6}

			)
			},
			onEachFeature: function(feature, layer) {
				layer.on('click',function(e) {
					map.setView(e.latlng);
					$("#paneltext").html('<h3> '+feature.properties.city+' '
										+feature.properties.province +'</h3> 死亡率/Death Rate: '
										+feature.properties.death_rate+'%<br> 治愈率/Cure Rate: '
										+feature.properties.cure_rate+'%</p>');
				}),
				layer.bindPopup('<h3> '+feature.properties.province_cn+' '
									+feature.properties.city_cn +'</h3> 确诊/Confirmed: '
									+feature.properties.case+'<br> 剩余/Remaining: '
									+feature.properties.remain+'<br> 治愈/Recoverd: '
									+feature.properties.cure+'<br> 死亡/Death: '
									+feature.properties.death+'</p>', popup1)
			}
		}).addTo(remain);

		var death = new L.GeoJSON.AJAX("data/data.geojson",{
			style : function(feature) {
				return {
					color: getColor3(feature.properties.death),
					fillColor: getColor3(feature.properties.death),
					weight: 0.5,
					radius: getR(feature.properties.death)
				}
			},
			pointToLayer: function(geoJsonPoint, latlng) {
			return L.circleMarker(latlng,
				{
				color: "#000",
				weight: 5,
				opacity: 0.5,
				fillOpacity: 0.6}

			)
			},
			onEachFeature: function(feature, layer) {
				layer.on('click',function(e) {
					map.setView(e.latlng);
					$("#paneltext").html('<h3> '+feature.properties.city+' '
										+feature.properties.province +'</h3> 死亡率/Death Rate: '
										+feature.properties.death_rate+'%<br> 治愈率/Cure Rate: '
										+feature.properties.cure_rate+'%</p>');
				}),
				layer.bindPopup('<h3> '+feature.properties.province_cn+' '
									+feature.properties.city_cn +'</h3> 确诊/Confirmed: '
									+feature.properties.case+'<br> 剩余/Remaining: '
									+feature.properties.remain+'<br> 治愈/Recoverd: '
									+feature.properties.cure+'<br> 死亡/Death: '
									+feature.properties.death+'</p>', popup3)
			}
		}).addTo(death);

		var recover = new L.GeoJSON.AJAX("data/data.geojson",{
			style : function(feature) {
				return {
					color: getColor4(feature.properties.cure),
					fillColor: getColor4(feature.properties.cure),
					weight: 0.5,
					radius: getR(feature.properties.cure)
				}
			},
			pointToLayer: function(geoJsonPoint, latlng) {
			return L.circleMarker(latlng,
				{
				color: "#000",
				weight: 5,
				opacity: 0.5,
				fillOpacity: 0.6}

			)
			},
			onEachFeature: function(feature, layer) {
				layer.on('click',function(e) {
					map.setView(e.latlng);
					$("#paneltext").html('<h3> '+feature.properties.city+' '
										+feature.properties.province +'</h3> 死亡率/Death Rate: '
										+feature.properties.death_rate+'%<br> 治愈率/Cure Rate: '
										+feature.properties.cure_rate+'%</p>');
				}),
				layer.bindPopup('<h3> '+feature.properties.province_cn+' '
									+feature.properties.city_cn +'</h3> 确诊/Confirmed: '
									+feature.properties.case+'<br> 剩余/Remaining: '
									+feature.properties.remain+'<br> 治愈/Recoverd: '
									+feature.properties.cure+'<br> 死亡/Death: '
									+feature.properties.death+'</p>', popup4)
			}
		}).addTo(recover);

		var usa_cities = new L.GeoJSON.AJAX("data/us_data.geojson",{
			style : function(feature) {
				return {
					color: getColorUSStrike(feature.properties.case),
					fillColor: getColorUS(feature.properties.case),
					weight: 0.2,
					radius: getR(feature.properties.case)
				}
			},
			pointToLayer: function(geoJsonPoint, latlng) {
			return L.circleMarker(latlng,
				{
				color: "red",
				weight: 5,
				opacity: 0.9,
				fillOpacity: 0.2}

			)
			},
			onEachFeature: function(feature, layer) {
				layer.on('click',function(e) {
					map.setView(e.latlng);
					$("#paneltext").html('<p>美国县级数据更新于3月21日<br>US County data updated: March 21.</p>');
				}),
				layer.bindPopup('<h3> '+feature.properties.county+', '
									+feature.properties.state +'<br>'
									+'</h3><p>确诊/Confirmed: '
									+feature.properties.case +'</p>', popup5)
			}
		}).addTo(usa_cities);

		var uk = new L.GeoJSON.AJAX("data/england_data.geojson",{
			style : function(feature) {
				return {
					color: "red",
					fillColor: getColorUS(feature.properties.case),
					weight: 0.2,
					radius: getR(feature.properties.case)
				}
			},
			pointToLayer: function(geoJsonPoint, latlng) {
			return L.circleMarker(latlng,
				{
				color: "red",
				weight: 5,
				opacity: 0.9,
				fillOpacity: 0.22}

			)
			},
			onEachFeature: function(feature, layer) {
				layer.on('click',function(e) {
					map.setView(e.latlng);
					$("#paneltext").html('<p>英格兰数据更新于3月21日<br>England data updated: March 21.</p>');
				}),
				layer.bindPopup('<h3> '+feature.properties.county+', UK'
									+'</h3><p>确诊/Confirmed: '
									+feature.properties.case +'</p>', popup5)
			}
		}).addTo(uk);

		var europe = new L.GeoJSON.AJAX("data/europe_data.geojson",{
			style : function(feature) {
				return {
					color: "red",
					fillColor: "yellow",
					weight: 0.2,
					radius: getR(feature.properties.case)
				}
			},
			pointToLayer: function(geoJsonPoint, latlng) {
			return L.circleMarker(latlng,
				{
				color: "red",
				weight: 5,
				opacity: 0.9,
				fillOpacity: 0.22}

			)
			},
			onEachFeature: function(feature, layer) {
				layer.on('click',function(e) {
					map.setView(e.latlng);
					$("#paneltext").html('<p>欧洲数据更新于3月21日<br>European data updated: March 21.</p>');
				}),
				layer.bindPopup('<h3> '+feature.properties.state+' '
									+feature.properties.region+', '
									+feature.properties.country+'<br>'
									+feature.properties.cn+' '
									+'</h3><p>确诊/Confirmed: '
									+feature.properties.case +'</p>', popup5)
			}
		}).addTo(europe);



	//Add map
	var map = L.map('map', {
			center: [50,0],
		  zoom:3,
			zoomControl: true,
			maxBounds: [
        //south west
        [-89,-180],
        //north east
        [89,180]
			],
			layers: [default1, sites]
	});


		//Setting base layer and overlay layers

	var baseLayers = {
		"默认/Default": default1,
		"地形图/Topographic":topographic,
		"卫星图/Satellite": satellite,
		"边界图/Boundaries":boundary
	};

	var overlays = {
		"<span style='color:#fcbba1'>累计/Cumulative</span>": sites,
		"<span style='color:#c7e9c0'>剩余/Remaining": remain,
		"<span style='color:#9ecae1'>治愈/Recovered</span>": recover,
		"<span style='color:#9e9ac8'>死亡/Death</span>": death,
		"<span style='color:yellow'>美国疫情/United States</span>": usa_cities,
		"<span style='color:yellow'>英格兰疫情/England</span>": uk,
		"<span style='color:yellow'>西欧疫情/Western Europe</span>": europe
	};

//Add layer control
L.control.layers(baseLayers, overlays).addTo(map);
map.zoomControl.setPosition('bottomright');


//	});

</script>
</div>
</div>
</center>
 <div id="paneltext" align="left"></div>
 <div><center><a href="index.html">时间图</a></center></div>

</div>
</body>
</html>
